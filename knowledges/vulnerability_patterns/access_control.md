# Access Control Vulnerability

## Description

Access control vulnerabilities occur when sensitive functions lack proper authorization checks, allowing unauthorized users to execute privileged operations.

## Severity

**CRITICAL** to **HIGH** - Depends on function impact

## Impact

- Unauthorized minting/burning of tokens
- Contract pausing/unpausing by non-admins
- Unauthorized fund withdrawal
- Ownership transfer
- Parameter manipulation

## Vulnerable Patterns

### Pattern 1: Missing Access Control

```solidity
contract Vulnerable {
    address public owner;

    function mint(address to, uint amount) external {
        // ❌ No access control!
        _mint(to, amount);
    }

    function setOwner(address newOwner) external {
        // ❌ Anyone can become owner!
        owner = newOwner;
    }
}
```

### Pattern 2: Incorrect Modifier

```solidity
contract Vulnerable {
    address public owner;

    modifier onlyOwner() {
        require(msg.sender == owner);
        // ❌ Missing underscore - modifier does nothing!
    }

    function pause() external onlyOwner {
        paused = true;
    }
}
```

### Pattern 3: Constructor Not Called

```solidity
contract Vulnerable {
    address public owner;

    // ❌ Typo: "constructor" vs "costructor"
    function costructor() public {
        owner = msg.sender;
    }

    // Owner is never set, contract has no owner!
}
```

## Detection Strategy

### Code Patterns to Search

```solidity
function mint(          // High-value operations
function burn(
function pause(
function unpause(
function setOwner(
function upgrade(
function withdraw(
function transferOwnership(
```

### Questions to Ask

1. Does this function modify critical state?
2. Should only specific addresses call this?
3. Is there an `onlyOwner` or `onlyRole` modifier?
4. If modifier exists, is it correctly implemented?
5. Can I call this function as a random user?

## Attack Scenario

```solidity
contract TokenVulnerable {
    function mint(address to, uint amount) external {
        _mint(to, amount);  // No access control
    }
}

// Attacker:
TokenVulnerable token = TokenVulnerable(0x...);
token.mint(attacker, 1000000 ether);  // Success! Free tokens
```

## Mitigation

### 1. Use OpenZeppelin Access Control

```solidity
import "@openzeppelin/contracts/access/Ownable.sol";

contract Secure is Ownable {
    function mint(address to, uint amount) external onlyOwner {
        _mint(to, amount);
    }
}
```

### 2. Role-Based Access Control (RBAC)

```solidity
import "@openzeppelin/contracts/access/AccessControl.sol";

contract Secure is AccessControl {
    bytes32 public constant MINTER_ROLE = keccak256("MINTER_ROLE");

    constructor() {
        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);
    }

    function mint(address to, uint amount) external onlyRole(MINTER_ROLE) {
        _mint(to, amount);
    }
}
```

### 3. Custom Checks

```solidity
contract Secure {
    address public owner;
    mapping(address => bool) public authorized;

    modifier onlyOwner() {
        require(msg.sender == owner, "Not owner");
        _;  // ✅ Don't forget underscore!
    }

    modifier onlyAuthorized() {
        require(authorized[msg.sender], "Not authorized");
        _;
    }

    function pause() external onlyOwner {
        paused = true;
    }
}
```

## Real-World Examples

- **Parity Wallet Hack (2017)**: Lack of access control on `initWallet()` led to $30M loss
- **Poly Network (2021)**: $611M stolen due to missing access control on keeper functions
- **Numerous DeFi hacks**: Unauthorized minting, pausing, or withdrawal

## Validation Checklist

For each privileged function:

- [ ] Access control modifier present?
- [ ] Modifier correctly implemented (has `_`)?
- [ ] Modifier checks the right condition?
- [ ] Constructor properly sets initial owner?
- [ ] Can I call this as a random address? (test!)
- [ ] Are there any bypass paths?

## References

- [SWC-105: Unprotected Ether Withdrawal](https://swcregistry.io/docs/SWC-105)
- [SWC-106: Unprotected SELFDESTRUCT](https://swcregistry.io/docs/SWC-106)
- [OpenZeppelin Access Control](https://docs.openzeppelin.com/contracts/4.x/access-control)
